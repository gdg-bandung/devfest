---
import SpeakerCard from "../speaker-page/speaker-card.tsx";
import ArrowRight from "../ui/icons/arrow-right";
import { SPEAKERS } from "../../data/speakers.data";

import "@splidejs/splide/css";
import { PropertyType, ThemeColor } from "../../consts";
---

<section class="flex flex-col items-center py-20 lg:py-40 gap-7 lg:gap-[88px]">
  <div class="px-8 lg:px-16 xl:px-[180px] w-full">
    <div class="container mx-auto flex flex-row items-center justify-between">
      <h2 class="font-medium text-[40px] lg:text-7xl">SPEAKER</h2>
      <div id="speakers-arrow" class="flex flex-row gap-2 lg:gap-4">
        <button
          id="prev-button"
          class="w-[34px] h-[34px] lg:w-[68px] lg:h-[68px] bg-dark-gray rounded-full flex items-center justify-center cursor-pointer disabled:cursor-auto"
          disabled
          ><ArrowRight class="rotate-180 w-3 lg:w-6" fill="gray" /></button
        >
        <button
          id="next-button"
          class="w-[34px] h-[34px] lg:w-[68px] lg:h-[68px] bg-dark-gray rounded-full flex items-center justify-center cursor-pointer disabled:cursor-auto"
          ><ArrowRight class="w-3 lg:w-6" fill="white" /></button
        >
      </div>
    </div>
  </div>
  <div class="px-8 lg:px-16 xl:px-[180px] w-full relative overflow-hidden">
    <div class="container mx-auto">
      <div id="speakers-slide" class="splide">
        <div class="splide__track">
          <ul class="splide__list">
            {
              SPEAKERS.filter((_, index) => index < 5).map((speaker) => (
                <li class="splide__slide">
                  <SpeakerCard
                    name={speaker.name}
                    role={speaker.role}
                    themeColor={speaker.themeColor}
                    propertyType={speaker.propertyType}
                    photoUrl={speaker.photoUrl}
                  />
                </li>
              ))
            }
            <li class="splide__slide">
              <SpeakerCard
                name=""
                role=""
                themeColor={ThemeColor.BLUE}
                propertyType={PropertyType.GENERAL}
                isSeeAllSpeakerCard={true}
              />
            </li>
          </ul>
        </div>
      </div>
      <div
        class="absolute top-0 right-0 h-full hidden lg:block 3xl:hidden lg:w-24 xl:w-80 z-10"
        style="background: linear-gradient(90deg, rgba(31, 33, 35, 0) 0%, #1F2123 107.19%);
"
      >
      </div>
      <div
        class="absolute top-0 left-0 h-full hidden lg:block 3xl:hidden lg:w-24 xl:w-80 z-10 transform rotate-180"
        style="background: linear-gradient(90deg, rgba(31, 33, 35, 0) 0%, #1F2123 107.19%);
"
      >
      </div>
    </div>
  </div>
</section>

<script>
  import Splide from "@splidejs/splide";

  document.addEventListener("DOMContentLoaded", function () {
    const splide = new Splide("#speakers-slide", {
      perPage: 3,
      perMove: 1,
      breakpoints: {
        640: {
          perPage: 2,
          padding: 0,
          gap: "21px",
        },
        1024: {
          perPage: 2,
          padding: 0,
        },
      },
      rewind: false,
      gap: "44px",
      trimSpace: false,
      padding: 0,
      arrows: false,
      pagination: false,
    });
    splide.mount();

    splide.on("move", (newIndex) => {
      const prevButton = document.querySelector(
        "#speakers-arrow button:first-child"
      ) as HTMLButtonElement;
      const nextButton = document.querySelector(
        "#speakers-arrow button:last-child"
      ) as HTMLButtonElement;
      const prevArrow = prevButton?.querySelector("svg path");
      const nextArrow = nextButton?.querySelector("svg path");

      if (prevButton && prevArrow) {
        if (newIndex === 0) {
          prevButton.setAttribute("disabled", "true");
          prevArrow.setAttribute("fill", "gray");
        } else {
          prevButton.removeAttribute("disabled");
          prevArrow.setAttribute("fill", "white");
        }
      }

      if (nextButton && nextArrow) {
        if (newIndex >= splide.length - (splide?.options?.perPage || 0)) {
          nextButton.setAttribute("disabled", "true");
          nextArrow.setAttribute("fill", "gray");
        } else {
          nextButton.removeAttribute("disabled");
          nextArrow.setAttribute("fill", "white");
        }
      }
    });

    const prevButton = document.querySelector(
      "#speakers-arrow button:first-child"
    );
    const nextButton = document.querySelector(
      "#speakers-arrow button:last-child"
    );
    prevButton?.addEventListener("click", () => {
      splide.go("<");
    });
    nextButton?.addEventListener("click", () => {
      splide.go(">");
    });
  });
</script>
